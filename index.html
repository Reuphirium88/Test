<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç—á–µ—Ç: –•—Ä–æ–Ω–∏–∫–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è 23.07.2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (Warm neutrals with soft blue/green accents) -->
    <!-- Application Structure Plan: A single-page dashboard design. Top section for key daily stats, now including a local sentiment analysis. Main area features an interactive timeline of chat messages filterable by participant and theme. A new local summary button provides a high-level overview. A dedicated section for data visualizations (bar chart, donut chart) provides quantitative insights. This structure transforms a linear chat log into an explorable, multi-faceted report. -->
    <!-- Visualization & Content Choices:
    - Report Info: Communication volume per person -> Goal: Compare -> Viz: Bar Chart (Chart.js) -> Interaction: Hover for details -> Justification: Easily compare participation levels.
    - Report Info: Topics of discussion -> Goal: Inform/Proportions -> Viz: Donut Chart (Chart.js) -> Interaction: Hover for percentage -> Justification: Quickly understand the main focus of the day's conversations.
    - Report Info: Chronological chat log -> Goal: Organize/Inform -> Viz: Themed & color-coded message cards (HTML/CSS) -> Interaction: Filtering by theme/person -> Justification: Structures the narrative and allows focused reading.
    - Report Info: Daily Summary -> Goal: Inform/Summarize -> Viz: Modal with generated text -> Interaction: Button click -> Justification: Provides a quick, template-based overview of the entire day. Method: Local JavaScript.
    - Report Info: Team Sentiment -> Goal: Inform/Analyze -> Viz: Card with text and button -> Interaction: Button click -> Justification: Dynamically analyzes the team's mood based on keywords. Method: Local JavaScript.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        .filter-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .theme-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 90%;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #3b82f6;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">–•—Ä–æ–Ω–∏–∫–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è</h1>
            <p class="text-lg text-gray-500 mt-2">23 –∏—é–ª—è 2025</p>
        </header>

        <main>
            <section id="dashboard" class="mb-12">
                 <div class="text-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">–°–≤–æ–¥–∫–∞ –¥–Ω—è</h2>
                    <p class="mt-2 text-gray-600">–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø—Ä–æ—à–µ–¥—à–∏–π –¥–µ–Ω—å. –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –¥–∞–µ—Ç –æ–±—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–± –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ–º–∞—Ö –æ–±—Å—É–∂–¥–µ–Ω–∏—è –≤ –∫–æ–º–∞–Ω–¥–µ.</p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-3xl font-bold text-blue-600" id="participants-count">6</p>
                        <p class="text-sm text-gray-500 mt-1">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-3xl font-bold text-emerald-600" id="messages-count">230+</p>
                        <p class="text-sm text-gray-500 mt-1">–°–æ–æ–±—â–µ–Ω–∏–π</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow flex flex-col justify-between">
                         <div id="sentiment-display" class="flex-grow flex items-center justify-center">
                            <p class="text-3xl font-bold text-amber-600">ü§î</p>
                         </div>
                         <p class="text-sm text-gray-500 mt-1">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</p>
                         <button id="analyze-sentiment-btn" class="mt-2 text-xs bg-blue-500 text-white py-1 px-2 rounded-full hover:bg-blue-600 transition-colors">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-lg font-semibold text-rose-600 truncate">–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ä–æ–ª–µ–º</p>
                        <p class="text-sm text-gray-500 mt-1">–ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞</p>
                    </div>
                </div>
            </section>

            <section id="visuals" class="mb-12 bg-white p-6 rounded-lg shadow">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–Ω—è</h2>
                    <p class="mt-2 text-gray-600 max-w-3xl mx-auto">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –ø–æ–º–æ–≥–∞–µ—Ç –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å –¥–∏–Ω–∞–º–∏–∫—É –æ–±—â–µ–Ω–∏—è. –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∏ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–µ–º–∞–º, –≤—ã—è–≤–ª—è—è –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–ª–ª–µ–≥ –∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ–∫—É—Å—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="w-full">
                        <h3 class="text-lg font-semibold text-center mb-2">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h3>
                        <div class="chart-container">
                            <canvas id="participantsChart"></canvas>
                        </div>
                    </div>
                    <div class="w-full">
                        <h3 class="text-lg font-semibold text-center mb-2">–¢–µ–º—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π</h3>
                         <div class="chart-container">
                            <canvas id="topicsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="timeline">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-semibold text-gray-800">–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</h2>
                    <p class="mt-2 text-gray-600">–ü–æ–ª–Ω–∞—è —Ö—Ä–æ–Ω–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–Ω—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∏–∂–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É.</p>
                    <button id="generate-summary-btn" class="mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-indigo-700 transition-colors flex items-center gap-2 mx-auto">
                        –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–¥–∫—É –¥–Ω—è
                    </button>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow mb-8 sticky top-0 z-10">
                    <div class="mb-4">
                        <h3 class="font-semibold text-gray-700 mb-2">–§–∏–ª—å—Ç—Ä –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º:</h3>
                        <div id="participant-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-700 mb-2">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–º–∞–º:</h3>
                        <div id="theme-filters" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>

                <div id="timeline-container" class="space-y-6"></div>
            </section>
        </main>
    </div>

    <div id="summary-modal" class="modal-backdrop">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-900">–°–≤–æ–¥–∫–∞ –¥–Ω—è</h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="summary-content" class="text-gray-700 space-y-4"></div>
        </div>
    </div>

    <script>
        const chatData = [
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '10:29', text: '—É –º–µ–Ω—è –≤—á–µ—Ä–∞ —Å–ª—É—á–∞–π–Ω–æ –æ–±–Ω–æ–≤–∏–ª—Å—è —è–Ω–¥–µ–∫—Å –∏ —Ç–µ–ø–µ—Ä—å —É –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º—ã)))', theme: '–¢–µ—Ö. –ø—Ä–æ–±–ª–µ–º—ã' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '10:30', text: '–ü—Ä–æ—Å—Ç–æ —è, –∫–æ—Ç–æ—Ä–∞—è... –†–∞–±–æ—Ç–∞—Ç—å –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å? –†–∞–±–æ—Ç–∞–π, –†–∏—Ç–∞. –†–∞–±–æ—Ç–∞–π –≤–æ —Å–Ω–µ.', theme: '–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '10:30', text: '–¢–∞–∫(( –ø–æ–ø—Ä–æ–±—É–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö –≤—Å–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ö—Å—é—à–∞', time: '10:36', text: '–†–∏—Ç, –ª—É—á—à–µ –æ—Ç–¥—ã—Ö–∞–π. —É—Å–ø–µ–µ—à—å –Ω–∞—Ä–∞–±–æ—Ç–∞—Ç—å—Å—è —Ç–∞–∫, —á—Ç–æ —Ç–æ—à–Ω–∏—Ç—å –±—É–¥–µ—Ç. –≤—ã–∫–∏–Ω—å —ç—Ç—É –º—ã—Å–ª—å –∏–∑ –≥–æ–ª–æ–≤—ã –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è –æ—Ç–¥—ã—Ö–æ–º. –≤—Å–µ—Ö –¥–µ–Ω–µ–≥ –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å, –∞ –º–µ–Ω—Ç–∞–ª–∫—É –ø—Ä–æ—Å—Ä–∞—Ç—å –∑–∞–ø—Ä–æ—Å—Ç–æ.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '10:51', text: '–ù—É –¥–∞(( –Ω–∞–≤–µ—Ä–Ω–æ–µ —Ç–∞–∫ –ª—É—á—à–µ. –°–ø–∞—Å–∏–±–æ', theme: '–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è' },
            { author: '–ö—Å—é—à–∞', time: '10:52', text: '–∏ —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—à—å) —è –±—ã –ø–æ–¥–µ–ª–∏–ª–∞—Å—å –±—ã —Å —Ç–æ–±–æ–π —Å —Ä–∞–¥–æ—Å—Ç—å—é, –µ—Å–ª–∏ –±—ã –±—ã–ª–æ –±—ã —á–µ–º. –¢–∞–∫ —á—Ç–æ –±–µ–∑ –∫–∞–∫–∏—Ö –ª–∏–±–æ –º—É–∫ –≤—ã–±–æ—Ä–∞ - –ø—Ä–æ—Å—Ç–æ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–º –¥–Ω–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞!', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '10:56', text: '–†–µ–±—è—Ç–∞, –ø—Ä–æ–±–ª–µ–º–∞. –Ø –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞. –ß–µ–ª–æ–≤–µ–∫ —Ä–∞–Ω–µ–µ —É–∂–µ –±—ã–ª –Ω–∞ –Ω–µ–≥–∞—Ç–∏–≤–µ... –Ø –Ω–µ –º–æ–≥—É –∑–∞–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç, —á—Ç–æ–±—ã –æ–ø–ª–∞—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ... –æ–Ω–∞ —É–∂–µ –Ω–µ–¥–æ–≤–æ–ª—å–Ω–∞, –µ–π —É–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Ö–æ—á–µ—Ç—Å—è... –ß—Ç–æ –º–Ω–µ –¥–µ–ª–∞—Ç—å?', theme: '–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏' },
            { author: '–ö—Å—é—à–∞', time: '10:58', text: '–Ø –∑–Ω–∞–µ—à—å –∫–∞–∫ –µ—â—ë –¥–µ–ª–∞–ª–∞. –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —Å–∞–º–∞ –≤–ø–∏—Å—ã–≤–∞–ª–∞. –ó–∞—Ö–æ–¥–∏–ª–∞ –∏ –µ–π –∫–∏–¥–∞–ª–∞. –ê –ø–æ—Ç–æ–º –æ–Ω–∞ –º–µ–Ω—è–µ—Ç. –ù–æ –Ω–µ –∑–Ω–∞—é –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –ª–µ–≥–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ù–∏–∫–∏—Ç–∞ –ê–±—Ä–∞—à–µ–≤', time: '10:59', text: '–º–æ–ª–∏—Ç—å—Å—è', theme: '–Æ–º–æ—Ä' },
            { author: '–ö—Å—é—à–∞', time: '10:59', text: '–°–µ–π—á–∞—Å —è —Ç–µ–±–µ –ø–æ–∫–∞–∂—É. –ó–∞—Ö–æ–¥–∏–º –≤ –∞–¥–º–∏–Ω–∫—É. –ó–∞—Ö–æ–¥–∏–º, –∫–ª–∏–µ–Ω—Ç, –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞. –ò –≤–æ—Ç –∑–¥–µ—Å—å –µ—Å—Ç—å e-mail, –µ—Å—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å. –Ø —Å—é–¥–∞ –≤–≤–æ–¥–∏–ª–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –ø–∞—Ä–æ–ª—å, —Å–æ—Ö—Ä–∞–Ω—è–ª–∞ –∏ –æ—Ç—Å—ã–ª–∞–ª–∞ –µ–π.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '11:02', text: '–Ø –ø–æ—Ö–µ—Ä, –±–ª–∏–Ω, —Ç—É—Ç —á–µ–ª–æ–≤–µ–∫—É –Ω–∞–¥–æ –ø–æ–º–æ—á—å. –≠—Ç–æ –∂–µ –∫–∞–∫ –±—ã —Ç–æ–∂–µ, –≤–æ–∑–º–æ–∂–Ω–æ, –º–æ–∏ –¥–µ–Ω—å–≥–∏. –ï—Å–ª–∏ —è –µ–π —Å–µ–π—á–∞—Å –ø–æ–º–æ–≥—É –∫–∞–∫-—Ç–æ –∑–∞–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç, —Ç–æ –Ω–∏—à—Ç—è–∫ –∂–µ –±—É–¥–µ—Ç.', theme: '–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏' },
            { author: '–†–æ–º–∞–Ω', time: '11:10', text: '–ö—Å—Ç–∞—Ç–∏ –≥–æ–≤–æ—Ä—è, –≤—Å–µ–º, –∫–æ–º—É –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å –Ω–∞ –ø–æ—á—Ç—É... —è –æ–±—ã—á–Ω–æ –ø–∏—à—É –∏–º—è –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —á–µ—Ç—ã—Ä–µ —Ü–∏—Ñ—Ä—ã —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–æ—Å—Ç–æ–π, –æ—Ç–ø—Ä–∞–≤–ª—è—é –≤ WhatsApp, –≥–æ–≤–æ—Ä—é, –ø–æ—Ç–æ–º, –∫–∞–∫ –∑–∞–π–¥–µ—Ç–µ, –ø–æ–º–µ–Ω—è–π—Ç–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '11:13', text: '–∑–∞–¥–∞–ª–∞ –µ–π –ø–∞—Ä–æ–ª—å –∫–∞—Ä–æ—á–µ –∏ –Ω–∞–ø–∏—Å–∞–ª–∞ –Ω–∞ –ø–æ—á—Ç—É, –Ω–æ –ø–∏—Å—å–º–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—Ö–∞—Ö–∞—Ö—Ö–∞', theme: '–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '11:18', text: '–ø–æ—Ç–æ–º –æ–Ω–∞ –≤–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å, –Ω–æ –ø–∏—à–µ—Ç —á—Ç–æ –Ω–µ–≤–µ—Ä–Ω—ã–π. –¥–∞ –æ–Ω–∞ –≥–¥–µ-—Ç–æ —Å–∞–º–∞ —Ç—É–ø–∏—Ç', theme: '–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏' },
            { author: '–ö—Å—é—à–∞', time: '11:18', text: '–æ—Ö, –∑–∞—Ç—É–ø–æ—á–µ–∫. –∏ –ª–µ–∑—É—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. —Ç—É—Ç —Å –ø–∞—Ä–æ–ª–µ–º —É–∂–µ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è', theme: '–Æ–º–æ—Ä' },
            { author: '–ù–∏–∫–∏—Ç–∞ –ê–±—Ä–∞—à–µ–≤', time: '11:29', text: '—ç—Ç–æ –∫–æ–≥–¥–∞ —Å—á–µ—Ç –¥–ª—è —é—Ä –ª–∏—Ü –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç —Å—É—Ç–∫–∞–º–∏', theme: '–†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '11:30', text: '–£ –º–µ–Ω—è –æ–ø–ª–∞—Ç–∞ –∏–∑ –∑–∞ —Ä—É–±–µ–∂–∞ —Ç—Ä–µ—Ç–∏–π –¥–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∞–µ—Ç—Å—è', theme: '–†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã' },
            { author: '–ö—Å—é—à–∞', time: '11:31', text: '–≤—ã–ø–∞–ª–∞ –∫–ª–µ–≤–∞—è –ø—É—Ç–µ–≤–∫–∞ –≤ –ï–≥–∏–ø–µ—Ç –≥–æ—Ä—è—â–∞—è... –º–æ—è –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä–∞–Ω–∏—Ü–∞...', theme: '–ü–ª–∞–Ω—ã –Ω–∞ –æ—Ç–ø—É—Å–∫' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '11:35', text: '–≠—Ö, –∞ —è –≤ –¢–∞–π —Ö–æ—á—É –∏ –≤ –î–∞–≥–µ—Å—Ç–∞–Ω –∏ –≤ –ö–∏—Ç–∞–π', theme: '–ü–ª–∞–Ω—ã –Ω–∞ –æ—Ç–ø—É—Å–∫' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '11:36', text: '–Ø –Ω–∞ –±–∞–ª–∏ –∏–ª–∏ —à—Ä–∏ –ª–∞–Ω–∫—É. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –æ–∫–µ–∞–Ω –∏ –ø–æ–ª–∞–∑–∏—Ç—å —Ç–∞–º –ø–æ –∑–µ–ª–µ–Ω–∏', theme: '–ü–ª–∞–Ω—ã –Ω–∞ –æ—Ç–ø—É—Å–∫' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '11:46', text: '–ö—Å—é—à, –Ω—É —Å–º–æ—Ç—Ä–∏, —è –º–æ–≥—É 27 –∏—é–ª—è –≤—ã–π—Ç–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É... –µ—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—Å–µ —Ç–∞–º —É —Ç–µ–±—è —Å—Ä–æ—Å–ª–æ—Å—å, –≤—Å–µ —Ç–≤–æ–∏ –º–µ—á—Ç—ã —Å–±—ã–ª–∏—Å—å, —Ç–æ –≤–æ–æ–±—â–µ —è 27-–≥–æ –º–æ–≥—É –≤—ã–π—Ç–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '11:48', text: '–Ø —Ç—É—Ç –ø—ã—Ç–∞—é—Å—å –ø–æ –î–ú–° –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —ç—Ç–æ –≤–æ–æ–±—â–µ –Ω–µ —Å—É–ø–µ—Ä, –±–ª—è–¥—å, –ø—Ä–æ—Å—Ç–æ.', theme: '–ë—ã—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã' },
            { author: '–†–æ–º–∞–Ω', time: '11:49', text: '–û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ–±–ª–æ. –ü–æ–∑–≤–æ–Ω–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', time: '11:56', text: '...–ø–æ—ç—Ç–æ–º—É –Ω–µ –ø–∞—Ä—å—Å—è, –ø–æ–∑–≤–æ–Ω–∏—à—å, —Ç–∞–º —Å–∫–∞–∂–µ—à—å, –µ—Å–ª–∏ —á—Ç–æ, –∂–∞–ª–æ–±—ã —Å–∫–∞–∂–∏. –ó–∞–∫–æ–ª–µ–±–∞–ª–∞—Å—å, —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–æ–∂–Ω–æ. –í–æ—Ç –æ–Ω–∞, –∂–∞–ª–æ–±–∞ –Ω–∞ –≤—Å–µ —Å–ª—É—á–∞–∏ –∂–∏–∑–Ω–∏.', theme: '–Æ–º–æ—Ä' },
            { author: '–†–æ–º–∞–Ω', time: '11:59', text: '–Ø –≤–æ—Ç –∑–≤–æ–Ω–∏–ª –∏ –≥–æ–≤–æ—Ä–∏–ª, —É –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –≥–æ–ª–æ—Å–æ–º, –º–µ–Ω—è –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –≤ –∫–ª–∏–Ω–∏–∫—É... –ü—Ä–æ—Å—Ç–æ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ö—É–µ–≤—É—é –∫–ª–∏–Ω–∏–∫—É, —Ç—É—Ç –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–∏–Ω—É—Å', theme: '–ë—ã—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã' },
            { author: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ê–Ω–¥—Ä–µ–µ–≤–Ω–∞ –í', time: '12:25', text: '–î–∞, –∫–æ—à–µ—á–∫–∞ –º–æ—è, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ–∑–≤–æ–Ω–∏—Ç—å, –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –ø–æ –î–ú–°... –¢—ã –º–æ–∂–µ—à—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞ –≥–æ—Ä—è—á—É—é –ª–∏–Ω–∏—é –î–ú–° –∏ —Å—Ä–∞–∑—É —Å–ø—Ä–æ—Å–∏—Ç—å, –≤—Ö–æ–¥–∏—Ç –ª–∏ –≤ –Ω–∞—à –î–ú–° —Ç–æ-—Ç–æ, —Ç–æ-—Ç–æ. –ò –æ–Ω–∏ —Ç–µ–±–µ —Å–∫–∞–∂—É—Ç.', theme: '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å' },
            { author: '–ö—Å—é—à–∞', time: '12:54', text: '—è –º–∞–ª–µ–Ω—å–∫–∞—è –∏–≥—Ä–∞–ª–∞ –≤ –≥—Ç–∞ —Å–∞–Ω –∞–Ω–¥—Ä–µ–∞—Å, –ø–æ—Å–ª–µ —à–∫–æ–ª—ã –ø—Ä–∏—Ö–æ–¥–∏–ª–∞ –∏ –¥–∞–≤–∞–π —à–ª—é—Ö –¥–∞–≤–∏—Ç—å', theme: '–Æ–º–æ—Ä' },
            { author: '–ù–∏–∫–∏—Ç–∞ –ê–±—Ä–∞—à–µ–≤', time: '15:03', text: '–∞—Ö—É–µ–Ω–Ω–æ, –∏–∑-–∑–∞ —Ç–æ–≥–æ —á—Ç–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –Ω–µ –º–æ–∂–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Å—á–µ—Ç –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –∏ –Ω–µ —Ç—è–Ω—É—Ç—å —Å—É—Ç–∫–∞–º–∏, –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç —É–∂–µ —É—à–µ–ª', theme: '–†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã' },
            { author: '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ', time: '15:49', text: '–ü–∏—Ç–µ—Ä —Å—Ç–∞–ª —Å–∞–º—ã–º —É—Å—Ç–∞–≤—à–∏–º –≥–æ—Ä–æ–¥–æ–º –†–æ—Å—Å–∏–∏ ‚Äî –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π –∏—Å–ø—ã—Ç—ã–≤–∞—é—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ.', theme: '–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è' },
            { author: '–†–æ–º–∞–Ω', time: '16:03', text: '–≠—Ç–æ –Ω–∞—à–∞ –∂–∏–∑–Ω—å üòÇ –í—Å—è –∂–∏–∑–Ω—å –º–µ–º', theme: '–Æ–º–æ—Ä' },
            { author: '–†–æ–º–∞–Ω', time: '18:51', text: '–û–¥–∏–Ω–æ—á–Ω—ã–π –∑—É–±... –í –∫–æ–ª–ª–µ–∫—Ü–∏—é. –û—Å—Ç–∞–≤–ª—è–ª–∏ –∑–∞—è–≤–∫—É –Ω–∞ –∫—É—Ä—Å, –º–Ω–µ –Ω—É–∂–Ω–æ –∑—É–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å 1 –æ–∫—Ç—è–±—Ä—è', theme: '–ê–±—Å—É—Ä–¥ –¥–Ω—è' },
            { author: '–ö—Å—é—à–∞', time: '18:52', text: '—á—Ç–æ–± –Ω–∞—Å—Ç–æ–ª—å–∫–æ —É –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Ç—à–∏–±–∞–ª–æ, —è —Å–ø–µ—Ä–≤–∞ –ø–æ–¥—É–º–∞–ª–∞, —á—Ç–æ –æ–Ω–∞ –ø—å—è–Ω–∞—è', theme: '–ê–±—Å—É—Ä–¥ –¥–Ω—è' },
            { author: '–ö—Å—é—à–∞', time: '18:57', text: '–∫–∞–∫ –µ–π –∑—É–± –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —á–µ—Ä–µ–∑ –ø—è—Ç—å –º–∏–Ω—É—Ç –≤ –∫–æ–Ω—Ü–µ –Ω–µ–¥–µ–ª–∏ —Ä–æ–∂–∞—Ç—å. —è –º–æ–ª—á—É –ø—Ä–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∞', theme: '–ê–±—Å—É—Ä–¥ –¥–Ω—è' },
            { author: '–ö—Å—é—à–∞', time: '19:31', text: '–∫–æ—Ä–æ—á–µ, —è —Ä–∞–¥–∞, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Ä–∞–±–æ—á–µ–µ. —è –∫–∞–∫ –≤ —Ü–∏—Ä–∫–µ –ø–æ–±—ã–≤–∞–ª–∞. —Ç—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∏ —á—Ç–æ-—Ç–æ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–æ–µ, —Å–ª–æ–≤–Ω–æ –ª—é–¥–∏ —Å–ª–æ–º–∞–ª–∏—Å—å —Ä–∞–∑–æ–º...', theme: '–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è' },
        ];

        const participants = [...new Set(chatData.map(item => item.author))];
        const themes = [...new Set(chatData.map(item => item.theme))];
        const authorColors = { '–ï–ª–∏–∑–∞–≤–µ—Ç–∞ –°–µ–º—á–µ–Ω–∫–æ': 'text-rose-600', '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞': 'text-emerald-600', '–ö—Å—é—à–∞': 'text-sky-600', '–ù–∏–∫–∏—Ç–∞ –ê–±—Ä–∞—à–µ–≤': 'text-indigo-600', '–†–æ–º–∞–Ω': 'text-amber-600', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ê–Ω–¥—Ä–µ–µ–≤–Ω–∞ –í': 'text-fuchsia-600',};
        const themeColors = { '–¢–µ—Ö. –ø—Ä–æ–±–ª–µ–º—ã': 'bg-red-100 text-red-800', '–†–∞–∑–º—ã—à–ª–µ–Ω–∏—è': 'bg-gray-100 text-gray-800', '–í–∑–∞–∏–º–æ–ø–æ–º–æ—â—å': 'bg-green-100 text-green-800', '–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏': 'bg-orange-100 text-orange-800', '–Æ–º–æ—Ä': 'bg-yellow-100 text-yellow-800', '–†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã': 'bg-blue-100 text-blue-800', '–ü–ª–∞–Ω—ã –Ω–∞ –æ—Ç–ø—É—Å–∫': 'bg-teal-100 text-teal-800', '–ë—ã—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã': 'bg-purple-100 text-purple-800', '–ê–±—Å—É—Ä–¥ –¥–Ω—è': 'bg-pink-100 text-pink-800',};
        let activeParticipantFilter = 'all';
        let activeThemeFilter = 'all';

        document.addEventListener('DOMContentLoaded', () => {
            setupFilters();
            renderTimeline(chatData);
            createParticipantsChart();
            createTopicsChart();
            document.getElementById('participants-count').textContent = participants.length;
            setupModal();
            setupLocalFeatures();
        });
        
        function analyzeSentimentLocally() {
            const positiveKeywords = ['—Å–ø–∞—Å–∏–±–æ', '–ø–æ–º–æ—á—å', '–ø–æ–º–æ—â—å', '—Ä–µ—à–µ–Ω–∏–µ', '–Ω–∏—à—Ç—è–∫', '–ø—Ä–∏–∫–æ–ª—å–Ω–æ', '–∫–∞–π—Ñ', '–æ—Ç–¥—ã—Ö–∞–π', '–Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è', '—Ö–æ—Ä–æ—à–µ–µ', '—Ä–∞–¥–æ—Å—Ç—å—é'];
            const negativeKeywords = ['–ø—Ä–æ–±–ª–µ–º–∞', '–ø—Ä–æ–±–ª–µ–º—ã', '–Ω–µ –º–æ–≥—É', '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–Ω–µ–≥–∞—Ç–∏–≤–µ', '–Ω–µ–¥–æ–≤–æ–ª—å–Ω–∞', '–±–ª—è–¥—å', '–ø–∏–∑–¥–µ—Ü', '–∑–∞–∫–æ–ª–µ–±–∞–ª–∏', '—É—Å—Ç–∞–≤—à–∏–º', '–≤—ã–≥–æ—Ä–∞–Ω–∏–µ', '—Å—Ç—Ä–µ—Å—Å', '—Ç—Ä–µ–≤–æ–∂', '–∫–∞–ø–µ—Ü', '—Ö—É–µ–≤—É—é', '—Å–ª–æ–∂–Ω–æ'];
            
            let score = 0;
            const fullChatText = chatData.map(msg => msg.text.toLowerCase()).join(' ');

            positiveKeywords.forEach(word => {
                score += (fullChatText.match(new RegExp(word, 'g')) || []).length;
            });
            negativeKeywords.forEach(word => {
                score -= (fullChatText.match(new RegExp(word, 'g')) || []).length;
            });

            if (score > 3) return { mood: '–ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ', emoji: 'üòä', reason: '–í —á–∞—Ç–µ –ø—Ä–µ–æ–±–ª–∞–¥–∞–ª–∏ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â—å –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.' };
            if (score < -3) return { mood: '–ù–∞–ø—Ä—è–∂–µ–Ω–Ω–æ–µ', emoji: 'üò†', reason: '–ß–∞—Å—Ç–æ –æ–±—Å—É–∂–¥–∞–ª–∏—Å—å –ø—Ä–æ–±–ª–µ–º—ã –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.' };
            return { mood: '–°–º–µ—à–∞–Ω–Ω–æ–µ', emoji: 'ü§î', reason: '–î–µ–Ω—å –±—ã–ª –ø–æ–ª–æ–Ω –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º, —Ç–∞–∫ –∏ –º–æ–º–µ–Ω—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —é–º–æ—Ä–∞.' };
        }

        function generateSummaryLocally() {
            const themeCounts = themes.reduce((acc, theme) => {
                acc[theme] = chatData.filter(msg => msg.theme === theme).length;
                return acc;
            }, {});
            
            const sortedThemes = Object.entries(themeCounts).sort((a, b) => b[1] - a[1]);
            
            const mainTheme = sortedThemes[0] ? sortedThemes[0][0].toLowerCase() : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞';
            const secondTheme = sortedThemes[1] ? sortedThemes[1][0].toLowerCase() : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞';
            const sentiment = analyzeSentimentLocally();

            return `
                <p><strong>–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ –¥–Ω—è:</strong> ${mainTheme}.</p>
                <p><strong>–ö–ª—é—á–µ–≤—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è:</strong> –ö–æ–º–∞–Ω–¥–∞ –∞–∫—Ç–∏–≤–Ω–æ —Ä–µ—à–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –æ–∫–∞–∑—ã–≤–∞–ª–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â—å. –¢–∞–∫–∂–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±—ã–ª–æ —É–¥–µ–ª–µ–Ω–æ —Ç–µ–º–µ "${secondTheme}".</p>
                <p><strong>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω:</strong> ${sentiment.mood}. ${sentiment.reason}</p>
                <p><strong>–ò—Ç–æ–≥:</strong> –î–µ–Ω—å –±—ã–ª –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–º, —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —Ä–µ—à–µ–Ω–∏–∏ —Ä–∞–±–æ—á–∏—Ö –∑–∞–¥–∞—á, –Ω–æ —Ç–∞–∫–∂–µ –Ω–∞—à–ª–æ—Å—å –≤—Ä–µ–º—è –¥–ª—è –ª–∏—á–Ω—ã—Ö –æ–±—Å—É–∂–¥–µ–Ω–∏–π –∏ —é–º–æ—Ä–∞.</p>
            `;
        }

        function setupLocalFeatures() {
            const summaryBtn = document.getElementById('generate-summary-btn');
            const sentimentBtn = document.getElementById('analyze-sentiment-btn');
            const summaryContent = document.getElementById('summary-content');
            const sentimentDisplay = document.getElementById('sentiment-display');

            summaryBtn.addEventListener('click', () => {
                summaryContent.innerHTML = '<div class="flex justify-center items-center"><div class="spinner"></div></div>';
                document.getElementById('summary-modal').style.display = 'flex';
                
                setTimeout(() => {
                    const summary = generateSummaryLocally();
                    summaryContent.innerHTML = summary;
                }, 500);
            });

            sentimentBtn.addEventListener('click', () => {
                sentimentDisplay.innerHTML = '<div class="spinner mx-auto"></div>';
                setTimeout(() => {
                    const sentiment = analyzeSentimentLocally();
                    sentimentDisplay.innerHTML = `<p class="text-3xl font-bold text-amber-600" title="${sentiment.reason}">${sentiment.emoji}</p>`;
                }, 500);
            });
        }

        function setupModal() {
            const modal = document.getElementById('summary-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            closeModalBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        function setupFilters() {
            const participantFiltersContainer = document.getElementById('participant-filters');
            const themeFiltersContainer = document.getElementById('theme-filters');
            let participantButtons = `<button class="filter-btn active" data-filter="all" data-type="participant">–í—Å–µ</button>`;
            participants.forEach(p => { participantButtons += `<button class="filter-btn" data-filter="${p}" data-type="participant">${p}</button>`; });
            participantFiltersContainer.innerHTML = participantButtons;
            let themeButtons = `<button class="filter-btn active" data-filter="all" data-type="theme">–í—Å–µ —Ç–µ–º—ã</button>`;
            themes.forEach(t => { themeButtons += `<button class="filter-btn" data-filter="${t}" data-type="theme">${t}</button>`; });
            themeFiltersContainer.innerHTML = themeButtons;
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.className = 'filter-btn px-3 py-1 border border-gray-300 rounded-full text-sm hover:bg-gray-100 transition-colors';
                if(button.dataset.filter === 'all') button.classList.add('active');
                button.addEventListener('click', handleFilterClick);
            });
        }
        
        function handleFilterClick(event) {
            const filter = event.target.dataset.filter;
            const type = event.target.dataset.type;
            if (type === 'participant') activeParticipantFilter = filter;
            else if (type === 'theme') activeThemeFilter = filter;
            document.querySelectorAll(`.filter-btn[data-type="${type}"]`).forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            applyFilters();
        }

        function applyFilters() {
            let filteredData = chatData;
            if (activeParticipantFilter !== 'all') filteredData = filteredData.filter(item => item.author === activeParticipantFilter);
            if (activeThemeFilter !== 'all') filteredData = filteredData.filter(item => item.theme === activeThemeFilter);
            renderTimeline(filteredData);
        }

        function renderTimeline(data) {
            const timelineContainer = document.getElementById('timeline-container');
            timelineContainer.innerHTML = '';
            if (data.length === 0) {
                timelineContainer.innerHTML = `<div class="text-center text-gray-500 p-8 bg-white rounded-lg shadow">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—à–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º.</div>`;
                return;
            }
            data.forEach(item => {
                const authorColorClass = authorColors[item.author] || 'text-gray-700';
                const themeColorClass = themeColors[item.theme] || 'bg-gray-100 text-gray-800';
                const messageEl = document.createElement('div');
                messageEl.className = 'bg-white p-4 rounded-lg shadow-sm flex flex-col sm:flex-row gap-4';
                messageEl.innerHTML = `
                    <div class="flex-shrink-0 w-full sm:w-40">
                        <p class="font-bold ${authorColorClass}">${item.author}</p>
                        <p class="text-xs text-gray-400">${item.time}</p>
                    </div>
                    <div class="flex-grow border-t sm:border-t-0 sm:border-l border-gray-200 pt-4 sm:pt-0 sm:pl-4">
                        <p class="text-gray-800 whitespace-pre-wrap">${item.text}</p>
                        <div class="mt-3">
                            <span class="theme-tag ${themeColorClass}">${item.theme}</span>
                        </div>
                    </div>`;
                timelineContainer.appendChild(messageEl);
            });
        }

        function createParticipantsChart() {
            const ctx = document.getElementById('participantsChart').getContext('2d');
            const messageCounts = participants.map(p => chatData.filter(msg => msg.author === p).length);
            new Chart(ctx, {
                type: 'bar',
                data: { labels: participants, datasets: [{ label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π', data: messageCounts, backgroundColor: Object.values(authorColors).map(c => c.replace('text-', 'bg-').replace('-600', '-400')), borderColor: Object.values(authorColors).map(c => c.replace('text-', 'border-').replace('-600', '-600')), borderWidth: 1 }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true } }, plugins: { legend: { display: false } } }
            });
        }

        function createTopicsChart() {
            const ctx = document.getElementById('topicsChart').getContext('2d');
            const topicCounts = themes.map(t => chatData.filter(msg => msg.theme === t).length);
            const backgroundColors = themes.map(t => themeColors[t].split(' ')[0].replace('bg-', 'bg-').replace('-100', '-300'));
            new Chart(ctx, {
                type: 'doughnut',
                data: { labels: themes, datasets: [{ label: '–¢–µ–º—ã', data: topicCounts, backgroundColor: backgroundColors, hoverOffset: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }
    </script>
</body>
</html>
